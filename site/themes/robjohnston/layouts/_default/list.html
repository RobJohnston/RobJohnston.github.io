{{ define "main" }}

  {{ $isntDefault := not (or (eq (trim $.Site.Params.contentTypeName " ") "posts") (eq (trim $.Site.Params.contentTypeName " ") "")) }}
  {{ $contentTypeName := cond $isntDefault (string $.Site.Params.contentTypeName) "posts" }}

  {{ $PageContext := . }}
  {{/* Once either .Paginator or .Paginate is called while generating a page,
    its result is cached, and any subsequent similar call will reuse the cached result.
    So we define $pages instead of $paginator (using .Paginate) to avoid confusion. */}}
  {{ $pages := $PageContext.RegularPages }}
  {{ if .IsHome }}
    {{ $PageContext = .Site }}
    {{ $pages = where $PageContext.RegularPages "Type" $contentTypeName }}
  {{ end }}

  <div class="flex flex-col w-full max-w-4xl lg:max-w-5xl relative">
    <div class="flex flex-row">
      <section class="flex flex-col w-full md:w-2/3">
        {{ range (.Paginate $pages).Pages }}
          <article class="flex flex-col mt-6 mx-2 md:mx-0 rounded-lg overflow-hidden shadow-md bg-white dark:bg-gray-700">
            <div>
              <a href="{{ .RelPermalink }}">
                {{ partial "block/image.html" . }}
              </a>
            </div>
            <div class="flex flex-col gap-y-3 p-6">
              <h2 class="text-4xl font-semibold text-slate-800 dark:text-slate-200">
                <a href="{{ .RelPermalink }}">{{ .Title | .RenderString }}</a>
              </h2>

              {{ with .Params.series }}
              <div class="flex items-center gap-2 text-sm">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-emerald-600 dark:text-emerald-400" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                  <path d="M3 19a9 9 0 0 1 9 0a9 9 0 0 1 9 0"></path>
                  <path d="M3 6a9 9 0 0 1 9 0a9 9 0 0 1 9 0"></path>
                  <path d="M3 6l0 13"></path>
                  <path d="M12 6l0 13"></path>
                  <path d="M21 6l0 13"></path>
                </svg>
                <span class="text-emerald-700 dark:text-emerald-300 font-medium">
                  Part {{ $.Params.series_order }} of {{ index . 0 }} series
                </span>
              </div>
              {{ end }}

              {{ partial "block/desc.html" . }}
              {{ partial "block/taxonomies.html" .}}

              {{ partial "block/time.html" . }}
              {{ partial "block/author.html" . }}
            </div>
          </article>
        {{ end }}
      </section>
      <aside class="hidden md:flex flex-col md:w-1/3 ml-3 {{- if .Site.Params.header.sticky }} top-10 {{ else }} top-0 {{ end -}} sticky self-start">
        {{ partial "sidebar.html" . }}
      </aside>
    </div>

    {{ partial "pagination.html" . }}
  </div>
{{ end }}
